<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸˆ ã€ä»¤å’Œæœ€æ–°ç‰ˆã€‘ã‚ã‹ã­ã“ãƒã‚¤ãƒ³ãƒˆ æ²ç¤ºæ¿ ğŸ’°</title>
    <style>
        /* (CSSã¯å¤‰æ›´ãªã—ã€‚å‰å›ã¨åŒã˜ã‚‚ã®ã‚’ãã®ã¾ã¾ä½¿ç”¨) */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f7f7f7;
            color: #333;
            margin: 0;
            padding: 20px;
            text-align: center;
        }

        header {
            background-color: #ff6347;
            color: white;
            padding: 15px 0;
            margin-bottom: 30px;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        header h1 {
            margin: 0;
            font-size: 2em;
        }

        #point-list-container {
            max-width: 800px;
            margin: 0 auto;
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.1);
        }

        .point-entry {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            border-bottom: 1px solid #eee;
        }

        .point-entry:last-child {
            border-bottom: none;
        }

        .point-entry strong {
            font-size: 1.1em;
            color: #ff6347;
        }

        .point-value {
            font-size: 1.5em;
            font-weight: bold;
            color: #007bff;
        }

        #last-updated {
            margin-top: 20px;
            font-size: 0.9em;
            color: #777;
        }
    </style>
</head>
<body>

    <header>
        <h1>ğŸˆ ã€ä»¤å’Œæœ€æ–°ç‰ˆã€‘ã‚ã‹ã­ã“ãƒã‚¤ãƒ³ãƒˆ æ²ç¤ºæ¿ ğŸ’°</h1>
    </header>

    <div id="point-list-container">
        <h2>ç¾åœ¨ã®ãƒã‚¤ãƒ³ãƒˆçŠ¶æ³</h2>

        <div id="points-output"></div>

        <p id="last-updated">æœ€çµ‚æ›´æ–°æ—¥: <span></span></p>
    </div>

    <script>
        // â˜…â˜…â˜…ã“ã“ã«ã€ã‚¹ãƒ†ãƒƒãƒ—1ã§ã‚³ãƒ”ãƒ¼ã—ãŸCSVå½¢å¼ã®å…¬é–‹URLã‚’è²¼ã‚Šä»˜ã‘ã‚‹ï¼â˜…â˜…â˜…
        const DATA_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vT8nVd-Of8bJCoDCdySdyeMmbVYe_4kz1p5xepQ7VMGbRk4zOxaCp1P0Ez2NdHxqIqJ3dJMyFPpqWvr/pub?gid=0&single=true&output=csv';

        const outputDiv = document.getElementById('points-output');

        function loadPoints() {
            // CSVå½¢å¼ã§ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
            fetch(DATA_URL)
                .then(response => {
                    if (!response.ok) {
                        throw new Error('ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ');
                    }
                    return response.text(); // CSVãƒ‡ãƒ¼ã‚¿ã‚’ãƒ†ã‚­ã‚¹ãƒˆã¨ã—ã¦å–å¾—
                })
                .then(csvText => {
                    // CSVãƒ‡ãƒ¼ã‚¿ã‚’JavaScriptã®é…åˆ—ã«å¤‰æ›
                    const rows = csvText.trim().split('\n'); // è¡Œã”ã¨ã«åˆ†å‰²
                    const data = [];

                    // ãƒ˜ãƒƒãƒ€ãƒ¼è¡Œ (1è¡Œç›®: "åå‰", "ãƒã‚¤ãƒ³ãƒˆ") ã‚’ã‚¹ã‚­ãƒƒãƒ—ã—ã€2è¡Œç›®ã‹ã‚‰å‡¦ç†ã‚’é–‹å§‹
                    for (let i = 1; i < rows.length; i++) {
                        const row = rows[i].split(','); // ã‚«ãƒ³ãƒã§åˆ—ã‚’åˆ†å‰²
                        
                        // 1åˆ—ç›®:åå‰, 2åˆ—ç›®:ãƒã‚¤ãƒ³ãƒˆ (ãƒ€ãƒ–ãƒ«ã‚¯ã‚©ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å‰Šé™¤ã—ã¦æ•°å€¤åŒ–)
                        // CSVå…¬é–‹æ™‚ã€æ—¥æœ¬èªã‚„ã‚«ãƒ³ãƒã‚’å«ã‚€ã¨ãƒ€ãƒ–ãƒ«ã‚¯ã‚©ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã§å›²ã¾ã‚Œã‚‹ãŸã‚å‰Šé™¤ã™ã‚‹
                        const name = row[0] ? row[0].replace(/"/g, '').trim() : ''; 
                        const score = row[1] ? parseInt(row[1].replace(/"/g, '').trim(), 10) : 0; 
                        
                        if (name) { // åå‰ãŒç©ºã§ãªã‘ã‚Œã°è¿½åŠ 
                            data.push({ name: name, score: score });
                        }
                    }
                    
                    // =========================================================
                    // â˜…â˜…â˜… ãƒã‚¤ãƒ³ãƒˆï¼ˆscoreï¼‰ãŒé«˜ã„é †ï¼ˆé™é †ï¼‰ã«ã‚½ãƒ¼ãƒˆï¼ â˜…â˜…â˜…
                    data.sort((a, b) => b.score - a.score);
                    // =========================================================

                    let htmlContent = '';
                    
                    // ã‚½ãƒ¼ãƒˆã—ãŸãƒ‡ãƒ¼ã‚¿ã‚’å…ƒã«HTMLéƒ¨å“ã‚’çµ„ã¿ç«‹ã¦ã‚‹
                    data.forEach(person => {
                        const formattedScore = person.score.toLocaleString();
                        
                        htmlContent += `
                            <div class="point-entry">
                                <span><strong>${person.name}</strong>ã•ã‚“ã®ãƒã‚¤ãƒ³ãƒˆ</span>
                                <span class="point-value">${formattedScore} P</span>
                            </div>
                        `;
                    });

                    // çµ„ã¿ç«‹ã¦ãŸHTMLã‚’ãƒšãƒ¼ã‚¸ã«æŒ¿å…¥
                    outputDiv.innerHTML = htmlContent;

                    // æœ€çµ‚æ›´æ–°æ—¥ã‚’æ›´æ–°
                    const today = new Date().toLocaleDateString('ja-JP', {year: 'numeric', month: 'long', day: 'numeric'});
                    document.querySelector('#last-updated span').textContent = today;
                })
                .catch(error => {
                    console.error('ã‚¨ãƒ©ãƒ¼:', error);
                    outputDiv.innerHTML = '<p style="color:red;">ãƒã‚¤ãƒ³ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã‚ã¾ã›ã‚“ã§ã—ãŸã€‚ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã®URLã¨å…¬é–‹è¨­å®šã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚</p>';
                });
        }

        // ãƒšãƒ¼ã‚¸ãŒèª­ã¿è¾¼ã¾ã‚ŒãŸã‚‰ãƒã‚¤ãƒ³ãƒˆã‚’ãƒ­ãƒ¼ãƒ‰é–‹å§‹
        loadPoints();
    </script>
</body>
</html>
